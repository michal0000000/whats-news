$.holdReady(true);
    setTimeout(function () {
        console.log("waiting")
        $.holdReady(false);
    }, 3000);

$(document).ready(function () {

    console.log("waiting done")

    document.getElementsByClassName("page-load")[0].style.display = "none";

    var page = 1;
    var block_request = false;
    var end_pagination = false;

    $(window).scroll(function () {
        if($(window).scrollTop() >= $('.div').offset().top + $('.div').outerHeight() - window.innerHeight && end_pagination === false && block_request === false) {
            
            block_request = true;
            page += 1;

            $.ajax({
                type: 'GET',
                url: '',
                data: {
                    "page": page
                },
                success: function (data) {
                    document.getElementsByClassName("more-content-load")[0].style.display = "none";
                    if (data.end_pagination === true) {
                        end_pagination = true;
                    } else {
                        document.getElementsByClassName("more-content-load")[0].style.display = "none";
                        block_request = false;
                    }
                    $('.news-list').append(data.content);
                }
            })
            document.getElementsByClassName("more-content-load")[0].style.display = "block";
        }
    });
})



// An array and count to hold the new article elements
var newArticlesCount = 0;
var newArticles = [];

function fetchNewArticles() {
  $.getJSON("new_posts/", function(data) {

    // Iterate through the array of articles
    $.each(data.data, function(index, article) {

      console.log(article)

      // Create a new article element
      var articleElement = $("<div>");
      articleElement.class = "col-md-3 mb-4"

      var innerArticleElement = $("<div>");
      innerArticleElement.class = "card"

      var image = $("<img>");
      image.class = "card-img-top";
      image.src = article.image;

      var articleTexts = $("<div>");
      articleTexts.class = "card-body";

      var articleHeadline = $("<h5>");
      articleHeadline.text = article.headline;
      articleHeadline.class = "card-title";

      var articleText = $("<p>");
      articleText.text = article.subtitle;
      articleText.class = "card-text";

      var articleReadMore = $("<a>");
      articleReadMore.text = "Read More";
      articleReadMore.class = "btn btn-primary";

      articleTexts.append(articleHeadline)
      articleTexts.append(articleText)
      articleTexts.append(articleReadMore)

      innerArticleElement.append(image)
      innerArticleElement.append(articleTexts)

      articleElement.append(innerArticleElement)

      // Add the article element to an array
      newArticles.push(articleElement);

      // Update the new articles count and button text
      newArticlesCount += 1;

    });
    
    $("#new-articles-span").text(`${newArticlesCount} new articles`);
  });
}

// Call the fetchNewArticles function every minute
setInterval(fetchNewArticles, 10000);

// A click handler for the new articles button
$(".click-button").on("click",function() {
  // Add the new articles to the page
  console.log(newArticles)
  $("#articles").prepend(newArticles);
  // Clear the array of new articles
  newArticles.length = 0;
  // Reset the new articles count
  newArticlesCount = 0;
  // Update the button text
  $(this).text("No new articles");
});
